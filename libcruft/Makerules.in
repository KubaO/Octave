# @configure_input@
#
# Common rules for octave's libcruft directories.
#
# John W. Eaton
# jwe@bevo.che.wisc.edu
# University of Wisconsin-Madison
# Department of Chemical Engineering

SOURCES = *.f

DISTFILES = Makefile.in $(SOURCES) $(SPECIAL)

CRUFT_FSRC = $(wildcard $(srcdir)/*.f)
CRUFT_BASE = $(notdir $(CRUFT_FSRC))
CRUFT_CSRC = $(patsubst %.f, %.c, $(CRUFT_BASE))
CRUFT_OBJ = $(patsubst %.f, %.o, $(CRUFT_BASE))

ifeq ($(SHARED_LIBS), true)
  ifdef FPICFLAG
    CRUFT_PICOBJ := $(addprefix pic/, $(CRUFT_OBJ))
  endif
endif

CWD = $(shell pwd)
THISDIR = $(notdir $(CWD))

all: stamp-picdir $(CRUFT_OBJ) $(CRUFT_PICOBJ) \
	$(SPECIAL_DEPEND) $(SPECIAL_PICDEPEND)
.PHONY: all

stamp-picdir:
	if [ "$(SHARED_LIBS)" = true ]; then \
	  if [ -n "$(FPICFLAG)" ]; then \
	    if [ -d pic ]; then \
	      true ; \
	    else \
	      mkdir pic ; \
	    fi ; \
	  fi ; \
	else \
	  true ; \
	fi
	touch stamp-picdir

install: all
.PHONY: install

uninstall:
.PHONY: uninstall

tags: $(SOURCES)
	ctags $(SOURCES)

TAGS: $(SOURCES)
	etags $(SOURCES)

clean::
	rm -f *.a *.o pic/*.o
.PHONY: clean

mostlyclean::
	rm -f *.o pic/*.o
.PHONY: mostlyclean

distclean:: clean
	rm -f Makefile stamp-picdir
	-rmdir pic
.PHONY: distclean
	
maintainer-clean:: distclean
	rm -f tags TAGS stamp-picdir
	-rmdir pic
.PHONY: maintainer-clean

local-dist:
	ln $(DISTFILES) ../../`cat ../../.fname`/libcruft/$(THISDIR)
.PHONY: local-dist

dist:
	ln $(EXTERNAL_DISTFILES) ../../`cat ../../.fname`/libcruft/$(THISDIR)
.PHONY: dist
